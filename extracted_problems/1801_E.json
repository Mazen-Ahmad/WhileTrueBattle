{
  "contestId": 1801,
  "index": "E",
  "name": "Gasoline prices",
  "rating": 3000,
  "tags": [
    "implementation"
  ],
  "statement": "Berland — is a huge country consisting of $$$n$$$ cities. The road network of Berland can be represented as a root tree, that is, there is only $$$n - 1$$$ road in the country, and you can get from any city to any other exactly one way, if you do not visit any city twice. For the convenience of representing the country, for each city $$$i$$$, the city $$$p_i$$$ is fixed, equal to the first city to which you need to go from the city $$$i$$$ to get to the city $$$1$$$. In other words, the city $$$p_i$$$ is equal to the ancestor of the city $$$i$$$ if the tree is hung for the city $$$1$$$. There is one gas station in each city of Berland. Gas stations have special pricing, and for each gas station there is a fixed range of prices for which they are ready to sell gasoline. A gas station in the city with the number $$$i$$$ is ready to sell gasoline at any price from $$$l_i$$$ to $$$r_i$$$ inclusive. The King of Berland — is an exemplary family man, and for $$$m$$$ years, two sons were born to him every year. The king's children have been involved in public affairs since early childhood, and at the end of each year they check the honesty of gasoline prices. From birth, the king's children, who are born in the year $$$i$$$, are responsible for checking gasoline prices on the ways from the city of $$$a_i$$$ to the city of $$$b_i$$$ and from the city of $$$c_i$$$ to the city of $$$d_i$$$, respectively. The check is as follows: both children simultaneously start their journey from the cities $$$a_i$$$ and $$$c_i$$$, respectively. The first son of the king, born in the year $$$i$$$, moves along the path from the city $$$a_i$$$ to the city $$$b_i$$$, and the second — from the city $$$c_i$$$ to the city $$$d_i$$$. Children check that the price of gasoline in the city of $$$a_i$$$ coincides with the price of gasoline in the city of $$$c_i$$$. Next, they check that the price of gasoline in the second city on the way from $$$a_i$$$ to $$$b_i$$$ coincides with the price in the second city on the way from $$$c_i$$$ to $$$d_i$$$. Then they repeat the same thing for a couple of third cities on their paths and so on. At the end, they check that the price of gasoline in the city of $$$b_i$$$ coincides with the price of gasoline in the city of $$$d_i$$$. It is guaranteed that the length of the path from the city $$$a_i$$$ to the city $$$b_i$$$ coincides with the length of the path from the city $$$c_i$$$ to the city $$$d_i$$$. Gas stations must strictly obey the laws, and therefore all checks of gasoline prices should not reveal violations. Help Berland gas stations find out how many ways they can set gasoline prices for $$$m$$$ years. In other words, for each $$$i$$$ from $$$1$$$ to $$$m$$$, calculate how many ways you can set gasoline prices at all gas stations so that after the birth of the first $$$i$$$ pairs of the king's children, all their checks did not reveal violations, and at any gas station the price was in the acceptable price range. Since the number of such methods can be large, calculate the answer modulo $$$10^9 + 7$$$.",
  "inputFormat": "The first line contains a single integer $$$n$$$ ($$$1 \\le n \\le 200\\,000$$$) — the number of cities in Berland. The second line contains $$$(n - 1)$$$ numbers $$$p_2,\\ p_3,\\ p_4,\\ \\ldots,\\ p_n$$$ ($$$1 \\le p_i \\le n$$$), where $$$p_i$$$ denotes the number of the next city on the way from city $$$i$$$ to city $$$1$$$. In each of the following lines, two integers are given $$$l_i$$$ and $$$r_i$$$ ($$$1 \\le l_i \\le r_i < 10^9+7$$$), specifying the acceptable range of prices at the gas station number $$$i$$$. The following line contains a single integer $$$m$$$ ($$$1 \\le m \\le 200\\,000$$$) — the number of years during which two sons were born to the king. In each of the following $$$m$$$ lines, four integers are given $$$a_i$$$, $$$b_i$$$, $$$c_i$$$ and $$$d_i$$$ ($$$1 \\le a_i, b_i, c_i, d_i \\le n$$$), specifying two paths on which the king's children will check gasoline prices, born in the year $$$i$$$. It is guaranteed that the length of the path between the cities $$$a_i$$$ and $$$b_i$$$ is equal to the length of the path between the cities $$$c_i$$$ and $$$d_i$$$.",
  "outputFormat": "In $$$m$$$ lines, print one number each. The number in the $$$i$$$ line should be equal to the number of ways to set gasoline prices in all cities so that the king's children born in the years up to and including $$$i$$$ do not reveal violations in inspections. Output the numbers modulo $$$10^9 + 7$$$.",
  "sampleTests": [
    {
      "input": "5\n1 1 2 2\n2 4\n1 3\n1 3\n2 4\n4 4\n4\n1 1 2 2\n1 2 2 1\n3 4 4 3\n3 4 3 5",
      "output": "18\n18\n4\n0"
    }
  ],
  "timeLimit": 3500,
  "memoryLimit": 1024,
  "sourceUrl": "https://codeforces.com/problemset/problem/1801/E",
  "verified": true,
  "qualityScore": 4.0,
  "source": "codeforces-scraped"
}