{
  "contestId": 1540,
  "index": "C2",
  "name": "Converging Array (Hard Version)",
  "rating": 2900,
  "tags": [
    "implementation"
  ],
  "statement": "This is the hard version of the problem. The only difference is that in this version $$$1 \\le q \\le 10^5$$$. You can make hacks only if both versions of the problem are solved. There is a process that takes place on arrays $$$a$$$ and $$$b$$$ of length $$$n$$$ and length $$$n-1$$$ respectively. The process is an infinite sequence of operations. Each operation is as follows: First, choose a random integer $$$i$$$ ($$$1 \\le i \\le n-1$$$). Then, simultaneously set $$$a_i = \\min\\left(a_i, \\frac{a_i+a_{i+1}-b_i}{2}\\right)$$$ and $$$a_{i+1} = \\max\\left(a_{i+1}, \\frac{a_i+a_{i+1}+b_i}{2}\\right)$$$ without any rounding (so values may become non-integer). See notes for an example of an operation. It can be proven that array $$$a$$$ converges, i. e. for each $$$i$$$ there exists a limit $$$a_i$$$ converges to. Let function $$$F(a, b)$$$ return the value $$$a_1$$$ converges to after a process on $$$a$$$ and $$$b$$$. You are given array $$$b$$$, but not array $$$a$$$. However, you are given a third array $$$c$$$. Array $$$a$$$ is good if it contains only integers and satisfies $$$0 \\leq a_i \\leq c_i$$$ for $$$1 \\leq i \\leq n$$$. Your task is to count the number of good arrays $$$a$$$ where $$$F(a, b) \\geq x$$$ for $$$q$$$ values of $$$x$$$. Since the number of arrays can be very large, print it modulo $$$10^9+7$$$.",
  "inputFormat": "The first line contains a single integer $$$n$$$ ($$$2 \\le n \\le 100$$$). The second line contains $$$n$$$ integers $$$c_1, c_2 \\ldots, c_n$$$ ($$$0 \\le c_i \\le 100$$$). The third line contains $$$n-1$$$ integers $$$b_1, b_2, \\ldots, b_{n-1}$$$ ($$$0 \\le b_i \\le 100$$$). The fourth line contains a single integer $$$q$$$ ($$$1 \\le q \\le 10^5$$$). The fifth line contains $$$q$$$ space separated integers $$$x_1, x_2, \\ldots, x_q$$$ ($$$-10^5 \\le x_i \\le 10^5$$$).",
  "outputFormat": "Output $$$q$$$ integers, where the $$$i$$$-th integer is the answer to the $$$i$$$-th query, i. e. the number of good arrays $$$a$$$ where $$$F(a, b) \\geq x_i$$$ modulo $$$10^9+7$$$.",
  "sampleTests": [
    {
      "input": "3\n2 3 4\n2 1\n5\n-1 0 1 -100000 100000",
      "output": "56\n28\n4\n60\n0"
    }
  ],
  "timeLimit": 5000,
  "memoryLimit": 256,
  "sourceUrl": "https://codeforces.com/problemset/problem/1540/C2",
  "verified": true,
  "qualityScore": 4.0,
  "source": "codeforces-scraped"
}