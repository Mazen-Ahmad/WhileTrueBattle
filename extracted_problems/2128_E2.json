{
  "contestId": 2128,
  "index": "E2",
  "name": "Submedians (Hard Version)",
  "rating": 2600,
  "tags": [
    "implementation"
  ],
  "statement": "This is the hard version of the problem. The only difference is that in this version, you are asked to find a subarray for all submedians . You can make hacks only if both versions of the problem are solved. An integer $$$v$$$ is a median of an array $$$b$$$ of length $$$m$$$ if and only if: $$$v$$$ is greater than or equal to at least $$$\\lceil \\frac{m}{2} \\rceil$$$ elements of the array, and $$$v$$$ is less than or equal to at least $$$\\lceil \\frac{m}{2} \\rceil$$$ elements of the array. For instance: the only median of $$$[9, 3, 7]$$$ is $$$7$$$, the medians of $$$[5, 3, 7, 9]$$$ are $$$5$$$, $$$6$$$, and $$$7$$$, and the only median of $$$[2, 2, 2]$$$ is $$$2$$$. You're given an integer $$$k$$$ and an array $$$a_1, \\ldots, a_n$$$ of integers between $$$1$$$ and $$$n$$$. An integer $$$v$$$ from $$$1$$$ to $$$n$$$ is said to be a submedian if there exists at least one pair of indices $$$(l, r)$$$ such that $$$1 \\leq l \\leq r \\leq n$$$, $$$r - l + 1 \\geq k$$$, $$$v$$$ is a median of the subarray $$$[a_l, \\ldots, a_r]$$$. Find all submedians and for each of them, find any corresponding pair of indices $$$(l, r)$$$.",
  "inputFormat": "Each test contains multiple test cases. The first line contains the number of test cases $$$t$$$ ($$$1 \\le t \\le 50\\,000$$$). The description of the test cases follows. The first line of each test case contains two integers $$$n$$$ and $$$k$$$ ($$$1 \\leq k \\leq n \\leq 300\\,000$$$). The second line of each test case contains $$$n$$$ integers $$$a_1, a_2, \\ldots, a_n$$$ ($$$1 \\leq a_i \\leq n$$$). It is guaranteed that the sum of $$$n$$$ over all test cases doesn't exceed $$$300\\,000$$$.",
  "outputFormat": "For each test case, output your answer in the following format. On the first line, output $$$c$$$, the number of submedians . On the $$$i$$$-th of the following $$$c$$$ lines, output three integers $$$v_i$$$, $$$l_i$$$, and $$$r_i$$$ such that $$$r_i - l_i + 1 \\geq k$$$, and $$$v_i$$$ is one of the medians of the subarray $$$[a_{l_i}, \\ldots, a_{r_i}]$$$. Each submedian should be reported exactly once, that is, integers $$$v_1, \\ldots, v_c$$$ must be pairwise distinct. The order in which they are reported does not matter. If there are many solutions, you can print any of them.",
  "sampleTests": [
    {
      "input": "7\n4 3\n4 1 2 4\n5 2\n1 2 3 2 1\n5 3\n1 2 3 2 1\n5 3\n1 1 2 5 3\n1 1\n1\n2 1\n2 1\n4 1\n1 2 1 3",
      "output": "3\n2 1 4\n3 1 4\n4 1 4\n3\n1 4 5\n2 1 5\n3 3 4\n1\n2 2 4\n3\n1 1 3\n2 2 4\n3 3 5\n1\n1 1 1\n2\n1 1 2\n2 1 2\n3\n1 1 1\n2 2 2\n3 4 4"
    }
  ],
  "timeLimit": 3000,
  "memoryLimit": 512,
  "sourceUrl": "https://codeforces.com/problemset/problem/2128/E2",
  "verified": true,
  "qualityScore": 4.0,
  "source": "codeforces-scraped"
}