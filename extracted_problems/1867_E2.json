{
  "contestId": 1867,
  "index": "E2",
  "name": "Salyg1n and Array (hard version)",
  "rating": 2200,
  "tags": [
    "implementation"
  ],
  "statement": "This is the hard version of the problem. The only difference between the versions is the limit on the number of queries. In this version, you can make no more than 57 queries. You can make hacks only if both versions of the problem are solved. This is an interactive problem! salyg1n has given you a positive integer $$$k$$$ and wants to play a game with you. He has chosen an array of $$$n$$$ integers $$$a_1, a_2, \\ldots, a_n$$$ ($$$1 \\leq a_i \\leq 10^9$$$). You must print $$$a_1 \\oplus a_2 \\oplus \\ldots \\oplus a_n$$$, where $$$\\oplus$$$ denotes the bitwise XOR operation. You can make queries of the following type: $$$?$$$ $$$i$$$: in response to this query, you will receive $$$a_i \\oplus a_{i + 1} \\oplus \\ldots \\oplus a_{i + k - 1}$$$. Also, after this query, the subarray $$$a_i, a_{i + 1}, \\ldots, a_{i + k - 1}$$$ will be reversed, i.e., the chosen array $$$a$$$ will become: $$$a_1, a_2, \\ldots a_{i - 1}, a_{i + k - 1}, a_{i + k - 2}, \\ldots, a_{i + 1}, a_i, a_{i + k}, \\ldots, a_n$$$. You can make no more than $$$57$$$ queries to answer the problem.",
  "inputFormat": "The first line contains a single integer $$$t$$$ ($$$1 \\leq t \\leq 1000$$$) â€“ the number of test cases.",
  "outputFormat": "Output specification not found",
  "sampleTests": [
    {
      "input": "2\n4 2\n\n6\n\n4\n\n6 6\n\n4",
      "output": "? 1\n\n? 3\n\n! 2\n\n? 1\n\n! 4"
    }
  ],
  "timeLimit": 1000,
  "memoryLimit": 256,
  "sourceUrl": "https://codeforces.com/problemset/problem/1867/E2",
  "verified": true,
  "qualityScore": 4.0,
  "source": "codeforces-scraped"
}